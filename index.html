<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Smash Bros. Ultimate Character Name Modifier</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HomebrewHeroes/smashrenamer/style.css">
</head>
<body>
    <h1>Super Smash Bros. Ultimate Character Name Modifier</h1>
    
    <form id="nameChangeForm">
        <label for="characterName">Select the character:</label>
        <select id="characterName" name="characterName" required>
            <!-- Dropdown options will be dynamically populated -->
        </select><br>
        
        <label for="costume">Select the costume:</label>
        <select id="costume" name="costume" required>
            <!-- Costume options will be dynamically populated -->
        </select><br>
        
        <label for="newCharacterName">Enter the new character name:</label>
        <input type="text" id="newCharacterName" name="newCharacterName" required><br>
        
        <button type="submit">Apply Changes</button>
    </form>

    <div id="queue">
        <h2>Renaming Queue</h2>
        <ul id="queueList"></ul>
        <button id="exportButton">Export Queue</button>
    </div>

    <div id="result"></div>
    <div id="console" style="border: 1px solid #ccc; padding: 10px; margin-top: 10px;"></div>

    <script>
        $(document).ready(function() {
            var renameQueue = [];

            // Fetch character data from GitHub
            fetch('https://raw.githubusercontent.com/HomebrewHeroes/smashrenamer/main/characters.json')
                .then(response => response.json())
                .then(data => {
                    // Populate character dropdown
                    var characterDropdown = document.getElementById('characterName');
                    data.characters.forEach(function(character) {
                        var option = document.createElement('option');
                        option.value = character.code;
                        option.text = character.name;
                        characterDropdown.appendChild(option);
                    });
                })
                .catch(error => console.error('Error fetching character data:', error));

            // Populate costume dropdown
            var costumeDropdown = document.getElementById('costume');
            for (var i = 0; i < 8; i++) {
                var option = document.createElement('option');
                option.value = "c" + i.toString().padStart(2, '0');
                option.text = "Costume " + i.toString().padStart(2, '0');
                costumeDropdown.appendChild(option);
            }

            // Handle form submission
            document.getElementById('nameChangeForm').addEventListener('submit', function(event) {
                event.preventDefault();
                
                var characterCodeName = document.getElementById('characterName').value;
                var costume = document.getElementById('costume').value;
                var newCharacterName = document.getElementById('newCharacterName').value;

                // Check if the selected costume is already in the queue
                var replaceIndex = renameQueue.findIndex(item => item.costume === costume);
                if (replaceIndex !== -1) {
                    var replaceConfirm = confirm("There is already an item in the queue with the same costume. Do you want to replace it?");
                    if (replaceConfirm) {
                        console.log("Replacing item in queue: " + renameQueue[replaceIndex].character + " " + renameQueue[replaceIndex].costume);
                        renameQueue.splice(replaceIndex, 1);
                    } else {
                        return; // Do nothing if cancel is clicked
                    }
                }

                // Log actions to console on the website
                var consoleDiv = document.getElementById('console');
                consoleDiv.innerHTML += "<p>Renaming " + characterCodeName + " " + costume + " to " + newCharacterName + "</p>";

                // Add action to rename queue
                renameQueue.push({
                    character: characterCodeName,
                    costume: costume,
                    newName: newCharacterName
                });

                // Update queue display
                updateQueueDisplay();
            });

            // Function to update the display of the renaming queue
            function updateQueueDisplay() {
                var queueList = document.getElementById('queueList');
                queueList.innerHTML = '';

                renameQueue.forEach(function(item, index) {
                    var li = document.createElement('li');
                    li.textContent = item.character + ' ' + item.costume + ' -> ' + item.newName;

                    // Add Remove button
                    var removeButton = document.createElement('button');
                    removeButton.textContent = 'Remove';
                    removeButton.dataset.index = index;
                    removeButton.addEventListener('click', function() {
                        removeQueueItem(index);
                    });
                    li.appendChild(removeButton);

                    queueList.appendChild(li);
                });
            }

            // Function to remove a queue item
            function removeQueueItem(index) {
                console.log("Removing item from queue: " + renameQueue[index].character + " " + renameQueue[index].costume);
                renameQueue.splice(index, 1);
                updateQueueDisplay();
            }

            // Handle export button click
            document.getElementById('exportButton').addEventListener('click', function() {
                exportQueue();
            });

            // Function to export the renaming queue
            function exportQueue() {
                var data = JSON.stringify(renameQueue, null, 2);
                var blob = new Blob([data], { type: 'application/json' });
                var url = URL.createObjectURL(blob);

                var a = document.createElement('a');
                a.href = url;
                a.download = 'rename_queue.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        });
    </script>
</body>
</html>
